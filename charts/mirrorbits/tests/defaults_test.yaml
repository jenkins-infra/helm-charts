suite: default tests
values:
  - ../values.yaml
  - default_secrets_values.yaml
templates:
  - deployment.files.yaml
  - deployment.yaml
  - secret.yaml # Direct dependency of deployment.yaml
  - ingress.yaml
  - service.files.yaml
tests:
  - it: should not create any ingress by default
    template: ingress.yaml
    asserts:
      - hasDocuments:
          count: 0
  - it: Should set the correct service selector labels
    template: service.files.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Service
      - equal:
          path: spec.selector["app.kubernetes.io/name"]
          value: "mirrorbits-files"
      - equal:
          path: spec.selector["app.kubernetes.io/instance"]
          value: "RELEASE-NAME-files"
  - it: Should define the default "files" deployment
    template: deployment.files.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/name"]
          value: "mirrorbits-files"
      - equal:
          path: spec.template.metadata.labels["app.kubernetes.io/instance"]
          value: "RELEASE-NAME-files"
      - equal:
          path: "spec.template.spec.containers[*].imagePullPolicy"
          value: IfNotPresent
  - it: Should define the default "mirrorbits" deployment
    template: deployment.yaml
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: Deployment
      - equal:
          path: spec.template.spec.containers[*].imagePullPolicy
          value: IfNotPresent
